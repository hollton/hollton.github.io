title: 北京高精尖项目报告文档
date: 2017-09-15 12:03:38
tags:
categories: [工作]
---
# 一、介绍
- 报告模块为多角色公用，无角色访问限制
- 提供移动端适配

# 二、起步

## 1、入口
- 路由：`report/common/index`
- 依据用户角色CODE及报告类型report_type获取JSON配置文件。但当url传入指定用户角色code及user_id时，则使用指定的用户信息获取配置。
- 用户角色code：参见[北京高精尖-系统角色定义](http://wiki.sdp.nd/index.php?title=%E5%8C%97%E4%BA%AC%E9%AB%98%E7%B2%BE%E5%B0%96-%E7%B3%BB%E7%BB%9F%E8%A7%92%E8%89%B2%E5%AE%9A%E4%B9%89)
- report_type：报告分类[main:总|微|日常|素质测评，general:综合报告，compositive:能力素养，double:s双师绩效统计，progess:素质测评进度，advance:优势分析，index:首页，psychology:心理建模]
- 依据当前配置编译报告模版：`<esp-report-container report-option="reportConfigNow" load-data="loadData"></esp-report-container>`

## 2、JSON配置
- 路由：`report/common/index/config-data`
- 命名：{角色CODE}_{report_type}.json
- containerTemplate：报告容器使用的模版类型
- search：报告搜索，可指定指令类型(directiveName)、搜索参数(paramData)、额外配置(customOption)等，例如：

        "search": {
          "directiveName": "tabselect",
          "customOption": {
            "selectData":[{
              "code":"class"
            }],
            "paramData": {
              "exam_id": {
                "variableType": "$stateParams",
                "variableKey": "exam_id"
              }
            }
          }
        }
- navigation：侧边栏导航，可指定指令类型(directiveName)
- tab：报告tab切换，可指定指令类型(directiveName)、额外配置(customOption)中使用tabData获取tab数据项
- groupName：当前分组类型，当前角色查看其他角色报告时，需用groupName过滤panel项
- reportPanelArrayOther：其他角色JSON配置，当前角色查看其他角色报告时，需先引入其配置，例如市级管理员引入区县管理员的报告配置：

        "reportPanelArrayOther":[{
          "groupName": "county",
          "configKey":"AREA_ADMIN_main"
        }]
- reportPanelArray：当前角色报告内容项。可指定子分类及tab分类，用于切换tab时过滤展示报告项(subGroupName)、panel指令名称后缀(panelType)、API接口，支持String及Array类型，Array类型可进一步指定个性参数及返回数据key(apiUrl)、额外配置(customOption)


## 3、容器report-container
- 路由：`report/common/index`






# 原型地址
[诊断报告_总测微测报告优化](http://svn.sdp.nd/svn/bj-edu/doc/%E6%9C%AA%E6%9D%A5%E6%95%99%E8%82%B2%E5%B9%B3%E5%8F%B0/03.%E8%AE%BE%E8%AE%A1/%E7%AD%96%E5%88%92%E8%AE%BE%E8%AE%A1/%E5%90%84%E7%89%88%E6%9C%AC%E5%8E%9F%E5%9E%8B%E6%96%87%E4%BB%B6/V0.8.23_2017.09.13/TQD61086_6%E3%80%90%E5%8C%97%E4%BA%AC%E9%AB%98%E7%B2%BE%E5%B0%96%E3%80%91%E3%80%90%E6%99%BA%E6%85%A7%E5%AD%A6%E4%BC%B4%E3%80%91%E8%AF%8A%E6%96%AD%E6%8A%A5%E5%91%8A_%E6%80%BB%E6%B5%8B%E5%BE%AE%E6%B5%8B%E6%8A%A5%E5%91%8A%E4%BC%98%E5%8C%96/TQD61086_6%E3%80%90%E5%8C%97%E4%BA%AC%E9%AB%98%E7%B2%BE%E5%B0%96%E3%80%91%E3%80%90%E6%99%BA%E6%85%A7%E5%AD%A6%E4%BC%B4%E3%80%91%E8%AF%8A%E6%96%AD%E6%8A%A5%E5%91%8A_%E6%80%BB%E6%B5%8B%E5%BE%AE%E6%B5%8B%E6%8A%A5%E5%91%8A%E4%BC%98%E5%8C%96/start.html#g=1&p=版本管理)

# 开发时间
- 开发：2017.08.23
- 提测：2017.09.12
- 生产：2017.09.19

# 开发人员
- 前端：刘浩东(170776) 念高伟(294310) 董海根(720114) 唐焱鑫(380984)
- 服务端：曹长荣(633592) 杨英宝(150303) 唐强(127002)
- IOS：吴于凌(520510)
- Android:葛文斌(890420)

# 代码规范
## 结构
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/C3F08A20F6D3491B8AE2C94769A8D923/7693)

### $directive
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/3490F9A11BBD488A9290E4D8357D5CEF/7692)
- 1、simple-xx：基础图表，与业务数据无关，越简单越好，如本次“学科关联性”图表可像这样新增一个指令
- 2、report-container：报告容器，提供多种容器模版。报告在此根据JSON配置编译组装report-search、report-panel指令，报告即由某个container模版包含某个search模版+多个panel模版组成
- 3、report-search：报告搜索头，提供多种模版，根据不同搜索条件查询服务端接口
- 4、report-panel：报告内容元，展示具体的业务数据，命名规则为"report-panel-xxx"（xxx均小写），如提供移动端模版，追加"-phone/pad"，本版本开发中，新增的panel指令，建议统一使用"report-panel-newxxx"命名以示区分（如report-panel-newability）

### $service
- 1、report-util：报告公用方法，有报告间公用逻辑可写在此

### common/index/config-data
- 2、JSON配置：

    “TERMTEST”：测评类型（“TERMTEST”、“UNITTEST”、“QOMTEST”）
    
    “containerTemplate”：container模版
    
    “search”：搜索部分，包含搜索模版及公用动态参数配置，动态参数指定解析类型及key，具体见report-container.js，开始访问api时解析参数
    
    “reportPanelArray”：panel数组配置，指定每个panel指令名称（panelType）、指令个性配置（customOption）、服务端api地址配置（apiUrl），需访问多个api接口可配置为数组形式，使用resDataKey以区分不同返回结果及使用paramData提供不同参数

![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/9DADD3B1CDA14E2AA303C4361CEF0414/7686)

### 移动端模版
- 在src/main/webapp/template.js文件中新增移动端模版路径配置，通过在报告页面url追加&from_where=ios&client=phone&mode=debug访问。
- 如：'views/report/$directive/report-panel/report-panel-basedata.html': {phone: 'phone'}

### 报告下载
- 模版中添加'report-download-item'下载报告时截取此dom。panel指令里都需要添加，包括移动端模版。
- 若模版内容较多，需拆分设置该类名，且覆盖整个模版有效区域，如：
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/4239B085BC4948F8B52CD9B350BEE4D7/7951)

## 注释
除了提供代码注释外，建议加上配置项的注释 ︿(￣︶￣)︽(￣︶￣)︿飞.飞.飞.
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/221BA1DCA5CA4BD180BEF370B1682732/7683)

## 新版报告配置
参考CITY_ADMIN_main.json
- "containerTemplate": "tab"
- 搜索模版使用"directiveName": "tabselect"
- 搜索新增tabData：报告内页切换（测评情况-能力分析）
- 搜索新增selectData：报告下拉项，其中"depend"表明其数据依赖项
- reportPanelArrayOther：配置下级角色的报告复用，与selectData呼应，其中configKey指定所复用的配置文件
- reportPanelArray：本级报告配置项，其中subGroupName表显示报告项，overview-测评情况，analysis-能力分析

# 功能拆分
### 报告内容：使用角色 + 开发类型 + 优先级 + 周期 + 开发人员 + 备注
##### 开发类型：new为需新开发；edit为可修改原有指令开发；edit+new为建议拷贝已有代码，新建指令修改开发
##### 优先级：!越多优先级建议越高
##### 学生、教师角色需考虑移动端的样式
##### panel指令都需提供空数据冒泡
表明当前panel数据是否为空，如：

    $scope.$emit("report:panel:showEmpty",isEmpty);


- [x] 1、Tab搜索report-search：全角色 new  !!! 1 浩东  
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/14EAA37ED1D04C898F301A64002275F4/7679)

- [x] 2、报告页内导航，考虑布局：全角色 new  !!! 1 浩东 
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/FF3C3A7397104825A4FB1E91F31F1024/7681)

- [x] 3、tab跳转按钮：全角色 new !! 1 浩东 
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/74AC593EE52E45ED88B50F25F701018D/7696)

- [x] 4、测评情况-整体情况（分数排名）：学生（移动端） edit+new !! 1 海根 参考report-panel-basedata
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/8C6DF816F14B46F79D259FF8B036DA09/7689)

- 5、测评情况-答题详情：学生（移动端） new !! 1 海根
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/D82E447FC2794B2AADBD9AAE6E95E271/7694)

- [x] 6、测评情况-薄弱知识点分析：学生（移动端） new !! 1 高伟
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/2CE4F964327E4AF7AD9C57D850837EEA/7857)

- [x] 7、测评情况-薄弱知识点分析：学生（移动端） new !! 1 高伟
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/9C457C6E9ECA449ABB3BF29B59CD2EB7/7688)

- [x] 8、测评情况-学习提升：学生（移动端） new !! 1 高伟
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/D978720B3CF947D89E57F3F12F6C743A/7695)

- [x] 9、能力分析-整体情况(考试评价)：学生（移动端） edit+new !!  1 海根 参考report-panel-basedata
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/E0C0C0C8E8E74B0791FEE6664DA43052/7668)

- [x] 10、能力分析-学科能力表现：学生+教师（移动端）+班主任 edit+new !!! 1 浩东
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/3C2EA58BE76A43A5BF8F2D9A9013217B/7664)


- [x] 11、能力分析-学科能力表现：年级主任+教研员+学校+学区+区县+市级+学科  !!! 1 浩东
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/6B771829B5EE47878261867EF2025E63/7669)

- [x] 12、能力分析-主题能力表现：学生+教师（移动端）+班主任  !!! 1 浩东 部分复用10
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/5359A4DBCBE84C82AB20FACF46294485/7670)

- [x] 13、能力分析-主题能力表现：年级主任+教研员+学校+学区+区县+市级+学科  !!! 1 浩东 部分复用11
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/2FB233DA63744026932FFB97500938ED/7682)


- [x] 14、能力分析-核心素养表现：学生+教师（移动端）+班主任 edit+new !! 2 高伟 参考report-panel-tagscore
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/6A06607D78104FE0A870B99152E091A3/7678)

- 15、能力分析-核心素养表现：年级主任+教研员+学校+学区+区县+市级+学科 edit+new !! 2 高伟 参考report-panel-tagscore
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/FAB9A34A66814346A78445E56464216A/8001)

- [x] 16、能力素养-历次总测总分排名：学生（移动端） edit ! 2 海根 report-panel-termtestscoreorderhistorydatas
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/109AE3ADD03543F9B60E8D5D4F11CDF0/7677)

- [x] 17、测评情况-整体情况(考试概况+分数分布)：教师（移动端）+班主任+年级主任+教研员+学校+学区+区县+市级+学科 new !!! 1 浩东  参考report-panel-scoredistribution
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/E88CD7F850984448AEADFD0063B9D424/7680)
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/2C934406C6BA43FABE1E6C0F04BBA5B3/7675)

- [x] 18、测评情况-整体情况(考试概况+分数分布)：教师（移动端）+班主任+年级主任+教研员+学校+学区+区县+市级+学科 new !!! 1 浩东  参考report-panel-scoredistribution 部分复用17
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/E88CD7F850984448AEADFD0063B9D424/7680)
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/2C934406C6BA43FABE1E6C0F04BBA5B3/7675)


- [x] 19、测评情况-学生成绩详情(学生作答情况)：教师（移动端）+班主任+年级主任+学校+学区+区县+市级 new !!! 1 浩东 
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/51F32EE6E35A422784762A7BAFEDA635/7674)


- 20、测评情况-试卷作答统计：教师（移动端）+班主任+年级主任+教研员+学校+学区+区县+市级+学科 new !!! 2 高伟
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/9F98600D8EAE48EA9EBDE5CCBC26DDD9/7671)

- [x] 21、测评情况-知识点掌握情况：教师（移动端）+班主任+年级主任+教研员+学校+学区+区县+市级+学科 edit+new !!! 2 海根 参考report-panel-basedata
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/FBDAC96E17A446FC812401F8DDA9BBE2/7690)

- [x] 22、测评情况-学习目标掌握情况：教师（移动端）+班主任+年级主任+教研员+学校+学区+区县+市级+学科 edit+new !!! 2 海根 参考report-panel-basedata
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/BCE773EBE8E443019B946452BAAFD528/7999)

- [x] 23、能力分析-能力水平分布：教师（移动端）+班主任+年级主任+教研员+学校+学区+区县+市级+学科 edit+new !!! 1 浩东 参考report-panel-abilityscale
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/4345E97D307B4135B446E850B64C6C46/7673)
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/91F0F570DCE845AE8B9FE7715996C234/7672)

- 24、能力分析-试卷分析：教师（移动端）+班主任+年级主任+教研员+学校+学区+区县+市级+学科 edit !! 2 唐总 report-panel-paperanalysis
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/C0854D34D33A47BDBA6ED0859A8F6F18/7666)

- 25、能力素养-学生能力水平分布：教师（移动端） edit ! 2 浩东
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/AD880FDCEFCF48BB8B5C3F482372D778/7687)

- 26、总测列表-综合报告列表+学科报告列表：班主任+年级主任+学校+学区+区县+市级 edit !!! 1 唐总
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/20A3A0349C694C1B982744C8C0CDC76B/7691)

- [x] 27、综合报告-能力分析-学科能力表现：班主任+年级主任+学校+学区+区县+市级 new !! 2 浩东
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/37D10F18E3D343718819836019B709F4/7667)

- [x] 28、综合报告-能力分析-学科关联性：年级主任+学校+学区+区县+市级 new !! 1 高伟  参考[highcharts dome](https://www.hcharts.cn/demo/highcharts/heatmap)
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/AD45C53F34554A988EB68B9FD5C8571C/7684)

- 29、测评情况-班级成绩分析（班级成绩分布+班级成绩详情-可复用学生成绩详情部分）：年级主任+教研员+学校+学区+区县+市级+学科 new !! 2 浩东
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/B159D31D0C364D79BDAF7DB0AC0EACF5/7665)

- 30、报告设置：系统管理员 new !! 2 海根
![image](http://note.youdao.com/yws/public/resource/e1fd652d2a1b26e7528c50434db8d311/xmlnote/814D72B4646A44C3AB1310182042D805/7851)